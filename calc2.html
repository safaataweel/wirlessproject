<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OFDM System Calculator</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --pink: #FF85A2;
      --pink-light: #FFB6C1;
      --pink-dark: #E75480;
      --purple: #B399D4;
      --white: #FFFFFF;
      --light-gray: #F8F9FA;
      --gray: #E9ECEF;
      --dark-gray: #6C757D;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background-color: var(--light-gray);
      color: #333;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      width: 100%;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--pink-dark);
      letter-spacing: -0.5px;
    }

    h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--pink-dark);
      border-bottom: 2px solid var(--pink-light);
      padding-bottom: 0.5rem;
    }

    .subtitle {
      color: var(--dark-gray);
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
      font-weight: 400;
    }

    .card {
      background-color: var(--white);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--pink);
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(255, 133, 162, 0.15);
    }

    .input-group {
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
    }

    .input-group label {
      min-width: 250px;
      margin-bottom: 0;
      margin-right: 1rem;
    }

    .input-field {
      display: flex;
      background-color: var(--gray);
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #ddd;
      flex: 1;
    }

    input, select {
      padding: 0.75rem 1rem;
      background: var(--white);
      border: none;
      color: #333;
      font-size: 1rem;
      outline: none;
      flex: 1;
    }

    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23E75480'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1rem;
    }

    .unit-label {
      padding: 0.75rem 1rem;
      background: var(--gray);
      color: var(--dark-gray);
    }

    .btn {
      background-color: var(--pink);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      font-size: 1rem;
      margin-top: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn:hover {
      background-color: var(--pink-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(231, 84, 128, 0.3);
    }

    .btn i {
      transition: transform 0.2s ease;
    }

    .btn:hover i {
      transform: translateX(3px);
    }

    .results-container {
      margin-top: 1.5rem;
    }

    .result-box {
      background-color: var(--gray);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1rem;
      border-left: 3px solid var(--pink);
    }

    .result-label {
      font-size: 0.9rem;
      color: var(--dark-gray);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .result-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--pink-dark);
    }

    .placeholder {
      color: var(--dark-gray);
      font-style: italic;
      padding: 1rem;
      text-align: center;
    }

    .error-message {
      color: var(--pink-dark);
      font-weight: 500;
      margin-top: 1rem;
      text-align: center;
      background-color: rgba(231, 84, 128, 0.1);
      padding: 0.75rem;
      border-radius: 8px;
      border-left: 3px solid var(--pink-dark);
    }

    footer {
      text-align: center;
      padding: 1.5rem;
      margin-top: auto;
      color: var(--dark-gray);
      font-size: 0.85rem;
      border-top: 1px solid var(--gray);
      font-weight: 400;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1.5rem 1rem;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      h2 {
        font-size: 1.3rem;
      }
      
      .card {
        padding: 1.5rem;
      }
      
      .input-group {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .input-group label {
        min-width: auto;
        margin-bottom: 0.5rem;
        margin-right: 0;
      }
      
      .input-field {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>OFDM System Calculator</h1>
      <p class="subtitle">Calculate data rates for resource elements, OFDM symbols, and resource blocks</p>
    </header>

    <main>
      <div class="card">
        <h2>System Parameters</h2>
        <div class="input-group">
          <label>Bandwidth of each resource block:</label>
          <div class="input-field">
            <input id="rbBandwidth" type="number" placeholder="e.g., 180" min="1">
            <span class="unit-label">kHz</span>
          </div>
        </div>

        <div class="input-group">
          <label>Subcarrier spacing:</label>
          <div class="input-field">
            <input id="subcarrierSpacing" type="number" placeholder="e.g., 15" min="1">
            <span class="unit-label">kHz</span>
          </div>
        </div>

        <div class="input-group">
          <label>Number of OFDM symbols per resource block:</label>
          <div class="input-field">
            <input id="symbolsPerRB" type="number" placeholder="e.g., 7" min="1">
          </div>
        </div>

        <div class="input-group">
          <label>Duration of each resource block:</label>
          <div class="input-field">
            <input id="rbDuration" type="number" placeholder="e.g., 0.5" min="0.1" step="0.01">
            <span class="unit-label">ms</span>
          </div>
        </div>

        <div class="input-group">
          <label>Modulation Type:</label>
          <div class="input-field">
            <select id="modulation">
              <option value="4">QAM</option>
              <option value="4" selected>QAM</option>
              <option value="2">PSK</option>
              <option value="4">QPSK</option>
            </select>
          </div>
        </div>

        <div class="input-group">
          <label>Number of parallel resource blocks:</label>
          <div class="input-field">
            <input id="parallelRBs" type="number" placeholder="e.g., 4" min="1" value="4">
          </div>
        </div>

        <button class="btn" onclick="calculate()">
          Calculate Bits per Resource Block <i class="fas fa-calculator"></i>
        </button>
      </div>

      <div class="card">
        <h2>Results</h2>
        <div class="results-container" id="results">
          <div class="placeholder">Please enter parameters and click Calculate</div>
        </div>
      </div>
    </main>
  </div>

  <footer>
    <div>Wireless and Mobile Network Course Project</div>
  </footer>

  <script>
    async function calculate() {
  // Get raw input values (strings for display)
  const bwRaw = document.getElementById('rbBandwidth').value;
  const spacingRaw = document.getElementById('subcarrierSpacing').value;
  const symbols = document.getElementById('symbolsPerRB').value;
  const durationRaw = document.getElementById('rbDuration').value;
  const qam = document.getElementById('modulation').value;
  const blocks = document.getElementById('parallelRBs').value;

  // Parse input values (converted to numbers for math)
  const rbBandwidth = parseFloat(bwRaw) * 1e3; // kHz to Hz
  const subcarrierSpacing = parseFloat(spacingRaw) * 1e3;
  const symbolsPerRB = parseInt(symbols);
  const rbDuration = parseFloat(durationRaw) * 1e-3; // ms to s
  const modulationOrder = parseInt(qam);
  const parallelRBs = parseInt(blocks);

  const bwUnit = 'kHz';
  const spacingUnit = 'kHz';
  const durationUnit = 'ms';
  const resultUnit = 'Mbps';

  // Validation
  if (
    isNaN(rbBandwidth) || isNaN(subcarrierSpacing) || isNaN(symbolsPerRB) ||
    isNaN(rbDuration) || isNaN(modulationOrder) || isNaN(parallelRBs)
  ) {
    document.getElementById('results').innerHTML = `
      <div class="error-message">Please fill in all fields with valid numbers</div>
    `;
    return;
  }

  if (rbBandwidth % subcarrierSpacing !== 0) {
    alert("‚ö†Ô∏è Bandwidth should be divisible by subcarrier spacing.");
    return;
  }

  if (Math.log2(modulationOrder) % 1 !== 0) {
    alert("‚ö†Ô∏è Modulation order should be a power of 2 (e.g., 4, 16, 64, 256).");
    return;
  }

  if (modulationOrder <= 0 || symbolsPerRB <= 0 || rbDuration <= 0 || parallelRBs <= 0) {
    alert("‚ö†Ô∏è Inputs must be positive non-zero values.");
    return;
  }

  // Constants
  const subcarriersPerRB = 12;

  // Calculations
  const totalSubcarriers = subcarriersPerRB;
  const bitsPerRE = Math.log2(modulationOrder);
  const bitsPerSymbol = totalSubcarriers * bitsPerRE;
  const bitsPerRB = bitsPerSymbol * symbolsPerRB;
  const dataRatePerRB = bitsPerRB / rbDuration;
  const maxTransmissionRate = dataRatePerRB * parallelRBs;
  const spectralEfficiency = maxTransmissionRate / (rbBandwidth * parallelRBs);

  // Display numeric results
  document.getElementById('results').innerHTML = `
    <div class="result-box">
      <div class="result-label">Bits per Resource Element (RE)</div>
      <div class="result-value">${bitsPerRE.toFixed(2)} bits</div>
    </div>
    <div class="result-box">
      <div class="result-label">Bits per OFDM Symbol</div>
      <div class="result-value">${bitsPerSymbol.toFixed(0)} bits</div>
    </div>
    <div class="result-box">
      <div class="result-label">Bits per Resource Block (RB)</div>
      <div class="result-value">${bitsPerRB.toFixed(0)} bits</div>
    </div>
    <div class="result-box">
      <div class="result-label">Data Rate per RB</div>
      <div class="result-value">${(dataRatePerRB / 1e3).toFixed(2)} kbps</div>
    </div>
    <div class="result-box">
      <div class="result-label">Max Transmission Rate (${parallelRBs} RBs)</div>
      <div class="result-value">${(maxTransmissionRate / 1e6).toFixed(2)} Mbps</div>
    </div>
    <div class="result-box">
      <div class="result-label">Spectral Efficiency</div>
      <div class="result-value">${spectralEfficiency.toFixed(2)} bps/Hz</div>
    </div>
  `;

  // Generate prompt for Gemini explanation
  const prompt = `
The user provided the following inputs:

- Bandwidth: ${bwRaw} ${bwUnit}
- Subcarrier Spacing: ${spacingRaw} ${spacingUnit}
- Number of Symbols per Block: ${symbols}
- Duration of Block: ${durationRaw} ${durationUnit}
- QAM order: ${qam}
- Number of Blocks: ${blocks}
- Desired Output Unit for rate: ${resultUnit}

Instructions:

1. Validate the inputs:
   - Check if bandwidth is divisible by subcarrier spacing.
   - Check if QAM is a power of 2.
   - Check that all numbers are positive and reasonable.
   - Mention if any input is invalid or suspicious.

2. Calculate step-by-step:
   - Bits per Resource Element (reBits) = log2(QAM)
   - Number of Subcarriers = Bandwidth / Subcarrier Spacing
   - Bits per OFDM Symbol = subcarriers * reBits
   - Bits per Resource Block = bits per symbol * number of symbols
   - Total bits = bits per block * number of blocks
   - Max transmission rate = total bits / duration
   - Convert max transmission rate to the desired output unit.

3. For each calculation step, provide a brief explanation of what it represents.

4. Explain the methodology in simple, clear, and friendly language targeted for beginners in wireless communication.

5. Summarize the final results clearly with units.

Output format:

Validation:
- [validation comments]

Calculations and Methodology:
- Step 1: ...
- Step 2: ...
- ...

Result Summary:
- Bits per Resource Element: ...
- Bits per OFDM Symbol: ...
- Bits per Resource Block: ...
- Max Transmission Rate: ... ${resultUnit}
`;

  // Gemini API call for detailed explanation
  try {
    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyBws1CJL9Kfmta32bLWXKL3nAkuU-Ly9Iw', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [
          {
            parts: [{ text: prompt }]
          }
        ]
      })
    });

    const data = await response.json();
    const explanation = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No explanation.";

    document.getElementById('results').innerHTML += `
      <div class="result-box" style="grid-column: span 2;">
        <div class="result-label">üìò Methodology & Explanation</div>
        <div class="result-value" style="white-space: pre-wrap;">${explanation}</div>
      </div>
    `;
  } catch (err) {
    console.error("Gemini failed:", err);
    alert("‚ö†Ô∏è Failed to fetch detailed explanation.");
  }
}

  </script>
</body>
</html>